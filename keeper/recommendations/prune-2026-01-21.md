# Keeper Prune Recommendations
Generated: 2026-01-21
Analyzed: townview (Town View Dashboard)

## Executive Summary
- **High Priority**: 2 recommendations
- **Medium Priority**: 3 recommendations
- **Low Priority**: 2 recommendations

---

## High Priority Recommendations

### PRUNE-001: Consolidate Issue Editor Form Wrappers
**Category**: Component Duplication
**Confidence**: High

**Current State**:
6 nearly identical wrapper components in `frontend/src/components/features/issue-editor/`:
- TitleInput.tsx
- DescriptionTextarea.tsx
- StatusDropdown.tsx
- PriorityDropdown.tsx
- AssigneeDropdown.tsx
- LabelsMultiSelect.tsx

All follow the same pattern: wrap base component (Input/Textarea/Select) + FormField.

**Recommendation**:
Create a generic `FormFieldWrapper` component that accepts:
- field type (input, textarea, select, multiselect)
- label, error, hint props
- field-specific options

Reduce 6 components → 1 generic component + configuration objects.

**Migration Scope**: 6 files affected
**Risk**: Low

---

### PRUNE-002: Extract Generic Fetch Hook Pattern
**Category**: Utility Pattern
**Confidence**: High

**Current State**:
4 hooks with 95%+ identical fetch boilerplate:
- useAgents.ts
- useMail.ts
- useMoleculeProgress.ts
- useAgentPeek.ts

Each duplicates: loading state, error state, try/catch pattern, error message extraction.

**Recommendation**:
Create `useFetch<T>` generic hook:
```typescript
function useFetch<T>(url: string, options?: FetchOptions): UseFetchResult<T>
```

**Migration Scope**: 4 hooks
**Risk**: Low
**Estimated LOC reduction**: 100-150 lines

---

## Medium Priority Recommendations

### PRUNE-003: Split utils.ts by Domain
**Category**: Code Organization
**Confidence**: Medium

**Current State**:
`frontend/src/lib/utils.ts` contains 15+ functions mixing:
- Status utilities (getStatusIcon, getStatusColorClass, getStatusBadgeClass)
- Priority utilities (getPriorityClass, getPriorityLabel, getPriorityBadgeClass)
- Agent utilities (getAgentStateIcon, getAgentStateClass, getAgentRoleIcon)

**Recommendation**:
Split into focused modules:
- `/lib/status-utils.ts`
- `/lib/priority-utils.ts`
- `/lib/agent-utils.ts`
- `/lib/class-utils.ts` (generic cn helper)

**Migration Scope**: 1 file → 4 files, update imports
**Risk**: Medium (many import sites)

---

### PRUNE-004: Extract Class Mapper Factory
**Category**: Utility Pattern
**Confidence**: Medium

**Current State**:
12+ switch-based functions with identical structure:
```typescript
function get*Class(value: string): string {
  switch (value) {
    case 'x': return 'class-x'
    // ...
  }
}
```

**Recommendation**:
Create factory function:
```typescript
const getStatusClass = createClassMapper<IssueStatus>({
  open: 'status-open',
  closed: 'status-closed',
  // ...
}, 'status-default')
```

**Migration Scope**: 12+ functions
**Risk**: Low

---

### PRUNE-005: Create useLocalStorage Hook
**Category**: Utility Pattern
**Confidence**: Medium

**Current State**:
`useTheme.ts` directly uses localStorage for persistence.
`cache.ts` also uses localStorage with similar patterns.

**Recommendation**:
Create `useLocalStorage<T>(key, defaultValue)` hook for consistent localStorage access with:
- JSON serialization
- Error handling
- SSR safety

**Migration Scope**: 2-3 files
**Risk**: Low

---

## Low Priority Recommendations

### PRUNE-006: Consolidate Error Message Extraction
**Category**: Utility Pattern
**Confidence**: Low

**Current State**:
Pattern repeated in 5+ locations:
```typescript
const message = err instanceof Error ? err.message : 'Failed to ...'
```

**Recommendation**:
Extract to `/lib/error-utils.ts`:
```typescript
function getErrorMessage(err: unknown, fallback: string): string
```

**Migration Scope**: 5+ files
**Risk**: Low

---

### PRUNE-007: Abstract Polling Interval Management
**Category**: Utility Pattern
**Confidence**: Low

**Current State**:
`useAgentPeek` and `useOffline` both manage polling intervals with similar logic.

**Recommendation**:
Create `usePolling(callback, interval, options)` hook if more polling use cases emerge.

**Migration Scope**: 2 files
**Risk**: Low

---

## Next Steps

To implement these recommendations:
1. Create an epic for "Frontend Code Consolidation"
2. Create subtasks for each PRUNE-XXX item
3. Assign to polecats for implementation

Priority order: PRUNE-001, PRUNE-002, PRUNE-003, PRUNE-004
