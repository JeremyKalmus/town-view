# Town View Frontend Seeds
# Patterns for React + Vite + TailwindCSS + shadcn/ui

components:
  # Base UI components (shadcn/ui based)
  - name: Button
    location: src/components/ui/button.tsx
    variants: [default, secondary, ghost, destructive]
    when_to_use: "All clickable actions"
    forbidden_extensions: []

  - name: Card
    location: src/components/ui/card.tsx
    variants: [default, elevated, accent]
    when_to_use: "Container for grouped content"
    forbidden_extensions: []

  - name: Badge
    location: src/components/ui/badge.tsx
    variants: [status, priority]
    when_to_use: "Status and priority indicators"
    forbidden_extensions: []

  - name: Input
    location: src/components/ui/input.tsx
    variants: [default, search]
    when_to_use: "Text input fields"
    forbidden_extensions: []

  - name: Select
    location: src/components/ui/Select.tsx
    variants: [default]
    when_to_use: "Dropdown selections"
    forbidden_extensions: []
    notes: |
      Uses native <select> with [color-scheme:dark] to ensure option elements
      render with dark background. This is required because <option> elements
      don't inherit CSS styles from parent - browsers render them with OS defaults.
      Always include text-text-primary and [color-scheme:dark] classes.

  - name: Modal
    location: src/components/ui/modal.tsx
    variants: [default, confirmation]
    when_to_use: "Dialogs and confirmations"
    forbidden_extensions: []

  - name: Toast
    location: src/components/ui/toast.tsx
    variants: [success, error, warning, info]
    when_to_use: "Transient notifications"
    forbidden_extensions: []

  - name: VirtualList
    location: src/components/ui/VirtualList.tsx
    variants: [fixed-height, dynamic-height]
    when_to_use: "Lists with 100+ items for performance"
    forbidden_extensions: []
    notes: "Use itemHeight for fixed, estimatedItemHeight for dynamic"

  # Feature components
  - name: IssueRow
    location: src/components/features/issue-row.tsx
    variants: [compact, detailed]
    when_to_use: "Displaying issues in lists"
    forbidden_extensions: []

  - name: AgentCard
    location: src/components/features/agent-card.tsx
    variants: [default]
    when_to_use: "Displaying agent status"
    forbidden_extensions: []

  - name: TreeNode
    location: src/components/features/tree-node.tsx
    variants: [default]
    when_to_use: "Epic/task hierarchy display"
    forbidden_extensions: []

  - name: RigItem
    location: src/components/features/rig-item.tsx
    variants: [default, selected]
    when_to_use: "Rig list items in sidebar"
    forbidden_extensions: []

  # Layout components
  - name: Sidebar
    location: src/components/layout/sidebar.tsx
    variants: [default]
    when_to_use: "Main navigation sidebar"
    forbidden_extensions: []

  - name: Header
    location: src/components/layout/header.tsx
    variants: [default]
    when_to_use: "Page headers"
    forbidden_extensions: []

  - name: SlideOut
    location: src/components/layout/slide-out.tsx
    variants: [default]
    when_to_use: "Side panel for editing"
    forbidden_extensions: []

hooks:
  - name: useRigs
    location: src/hooks/use-rigs.ts
    purpose: "Fetch and cache rig list"
    return_type: "{ rigs: Rig[], isLoading: boolean, error: Error | null }"

  - name: useIssues
    location: src/hooks/use-issues.ts
    purpose: "Fetch issues for a rig with filters"
    return_type: "{ issues: Issue[], isLoading: boolean, error: Error | null }"

  - name: useEventSource
    location: src/hooks/useEventSource.ts
    purpose: "Real-time updates via Server-Sent Events (SSE)"
    return_type: "{ connected: boolean, lastEvent: string | null }"
    notes: |
      Uses native EventSource API for SSE connections.
      Replaces useWebSocket hook as per ADR-005.
      Auto-reconnects on connection loss.

  - name: useIssueUpdate
    location: src/hooks/use-issue-update.ts
    purpose: "Mutation hook for updating issues"
    return_type: "{ update: (id, changes) => Promise, isPending: boolean }"

  - name: useAgentView  # discovered 2026-01-22
    location: src/hooks/useAgentView.ts
    purpose: "Get role-specific view data for agents (filtered issues, queue, metrics)"
    return_type: "UseAgentViewResult | null"
    notes: |
      Uses centralized agent-bead-config for consistent filtering.
      Returns: config, workload, queue, relevantIssues, monitoredAgents,
      mergeQueue, primaryMetric, showSection(), hookedIssue

# Agent-Bead Configuration System (discovered 2026-01-22)
# Central source of truth for agent role â†’ bead type relationships
agent_bead_config:
  location: src/lib/agent-bead-config.ts
  purpose: "Centralized mapping of agent roles to bead types for filtering and display"
  exports:
    - AGENT_VIEW_CONFIGS: "Record<role, AgentViewConfig> - configuration per role"
    - getAgentViewConfig: "(role) => AgentViewConfig"
    - filterIssuesForRole: "(issues, role) => Issue[] - filter to role-relevant beads"
    - getAgentWorkload: "(issues, agent) => Issue[] - assigned work"
    - getQueueForRole: "(issues, role) => Issue[] - available unassigned work"
    - getMergeQueue: "(issues) => Issue[] - MRs for refinery view"
    - getMonitoredAgents: "(agents, role) => Agent[] - agents being watched"
    - shouldShowSection: "(role, section) => boolean - check if UI section applies"
    - buildQueryForRole: "(role, agentId?) => IssueQueryParams - API query builder"
  role_configs:
    polecat:
      worksWith: [task, bug, feature, chore]
      produces: [merge-request, event]
      cardSections: [hooked_bead, recent_activity]
    crew:
      worksWith: [task, bug, feature, epic, chore, convoy]
      produces: [task, bug, feature, merge-request, event]
      cardSections: [hooked_bead, work_queue, convoy_progress, recent_activity]
    witness:
      worksWith: [molecule]
      monitors: [agent, merge-request]
      cardSections: [patrol_status, monitored_agents, recent_activity]
    refinery:
      worksWith: [merge-request]
      monitors: [merge-request]
      cardSections: [merge_queue, recent_activity]
    mayor:
      worksWith: [convoy, epic]
      produces: [convoy, task]
      cardSections: [hooked_bead, convoy_progress, recent_activity]
    deacon:
      worksWith: [molecule]
      monitors: [agent, rig]
      cardSections: [patrol_status, monitored_agents, recent_activity]
  bead_type_constants:  # Added 2026-01-22 ADR-004
    WORK_BEAD_TYPES:
      description: "Bead types representing actual work"
      types: [task, bug, feature, chore, merge-request, molecule]
      use_for: "Tab 1 in AgentPeekPanel - what the agent is DOING"
    EVENT_BEAD_TYPES:
      description: "Bead types representing lifecycle events"
      types: [event]
      use_for: "Tab 3 in AgentPeekPanel - what HAPPENED (session, wisp, patrol, merge events)"
  when_to_use: |
    Use this module whenever you need to:
    - Filter issues by agent role
    - Determine what bead types an agent works with
    - Build role-specific UI views/cards
    - Query for role-appropriate data
    - Separate work beads from event beads (use WORK_BEAD_TYPES/EVENT_BEAD_TYPES)
  forbidden_extensions:
    - Do not add role-specific logic elsewhere - centralize here
    - Do not hardcode bead type filters in components
    - Do not mix work and event beads in the same list/tab

state_stores:
  - name: rigStore
    location: src/stores/rig-store.ts
    manages: "Selected rig, rig list cache"
    library: zustand

  - name: uiStore
    location: src/stores/ui-store.ts
    manages: "Sidebar state, slide-out state, filters"
    library: zustand

design_tokens:
  location: src/styles/tokens.css
  format: css_custom_properties
  categories:
    - colors (status, priority, accent, neutral)
    - typography (font families, sizes, weights)
    - spacing (4px grid system)
    - borders (radius, widths)
    - shadows (elevation levels)
